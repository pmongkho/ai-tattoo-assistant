<div
	class="flex flex-col h-[calc(100vh-12rem)] bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden"
>
	<!-- Chat messages -->
        <div class="flex-grow overflow-y-auto p-4 space-y-4" #messageContainer>
                <div
                        *ngFor="let msg of messages"
                        [ngClass]="
                                msg.sender === 'user'
                                        ? 'ml-auto bg-emerald-600 text-white'
                                        : 'mr-auto bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white'
                        "
                        class="max-w-[80%] rounded-lg p-3 shadow-sm"
                        [class.opacity-80]="msg.pending"
                >
                        <div class="font-medium mb-1">{{
                                msg.sender === 'user' ? 'You' : 'AI Assistant'
                        }}</div>
                        <div class="flex items-start gap-2">
                                <svg
                                        *ngIf="msg.pending"
                                        class="h-4 w-4 text-emerald-500 animate-spin mt-0.5"
                                        xmlns="http://www.w3.org/2000/svg"
                                        fill="none"
                                        viewBox="0 0 24 24"
                                >
                                        <circle
                                                class="opacity-25"
                                                cx="12"
                                                cy="12"
                                                r="10"
                                                stroke="currentColor"
                                                stroke-width="4"
                                        ></circle>
                                        <path
                                                class="opacity-75"
                                                fill="currentColor"
                                                d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
                                        ></path>
                                </svg>
                                <p
                                        class="whitespace-pre-line"
                                        [ngClass]="
                                                msg.pending
                                                        ? 'italic text-gray-500 dark:text-gray-200'
                                                        : ''
                                        "
                                >
                                        {{ msg.text }}
                                </p>
                        </div>
                        <img
                                *ngIf="msg.imageUrl"
                                [src]="msg.imageUrl"
                                class="mt-2 max-w-full rounded"
                        />
                </div>

		<!-- Empty state -->
		<div
			*ngIf="messages.length === 0"
			class="flex flex-col items-center justify-center h-full text-center text-gray-500 dark:text-gray-400"
		>
			<svg
				xmlns="http://www.w3.org/2000/svg"
				class="h-16 w-16 mb-4 text-gray-300 dark:text-gray-600"
				fill="none"
				viewBox="0 0 24 24"
				stroke="currentColor"
			>
				<path
					stroke-linecap="round"
					stroke-linejoin="round"
					stroke-width="2"
					d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
				/>
			</svg>
			<p class="text-lg font-medium">Start a conversation</p>
			<p class="text-sm"
				>Type a message below to begin chatting with the AI Assistant</p
			>
		</div>
	</div>
<!-- helper hint so users give availability + name + phone -->
<div class="px-4 py-2 text-xs text-gray-500 dark:text-gray-400 border-t border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
  Online booking only â€” please share your availability (weekday/weekend + morning/afternoon/evening), full name, and phone for Square updates.
</div>

	<!-- Input area -->
	<div class="border-t dark:border-gray-700 p-4 bg-gray-50 dark:bg-gray-900">
                <div class="flex items-center space-x-2">
                        <input
                                type="file"
                                (change)="onFileSelected($event)"
                                accept="image/*"
                                class="hidden"
                                #fileInput
                        />
                        <button
                                type="button"
                                (click)="fileInput.click()"
                                class="bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 px-3 py-2 rounded-lg"
                        >
                                ðŸ“·
                        </button>
                        <input
                                type="text"
                                [(ngModel)]="userInput"
                                placeholder="Type your message here..."
                                (keyup.enter)="sendMessage()"
                                class="flex-grow px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition-colors dark:text-white"
                        />
                        <button
                                (click)="sendMessage()"
                                [disabled]="sending || (!userInput.trim() && !selectedFile)"
                                class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                                <svg
                                        *ngIf="!sending"
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="h-5 w-5"
                                        viewBox="0 0 20 20"
                                        fill="currentColor"
                                >
                                        <path
                                                d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"
                                        />
                                </svg>
                                <svg
                                        *ngIf="sending"
                                        class="h-5 w-5 animate-spin"
                                        xmlns="http://www.w3.org/2000/svg"
                                        fill="none"
                                        viewBox="0 0 24 24"
                                >
                                        <circle
                                                class="opacity-25"
                                                cx="12"
                                                cy="12"
                                                r="10"
                                                stroke="currentColor"
                                                stroke-width="4"
                                        ></circle>
                                        <path
                                                class="opacity-75"
                                                fill="currentColor"
                                                d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
                                        ></path>
                                </svg>
                        </button>
                </div>
        </div>
</div>
